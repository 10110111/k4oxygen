cmake_minimum_required(VERSION 2.8)
project(k4oxygen)

set(CMAKE_AUTOMOC ON)
if(NOT DEFINED QT_VERSION)
    set(QT_VERSION 4)
endif()
if("${QT_VERSION}" STREQUAL 5 OR "${QT_VERSION}" STREQUAL Qt5)
    message("++ Compiling style for for Qt 5")
    find_package(Qt5 5.5 REQUIRED Core DBus Gui Widgets X11Extras)
    set(QT_LIBRARIES ${Qt5Core_LIBRARIES} ${Qt5DBus_LIBRARIES} ${Qt5Gui_LIBRARIES} ${Qt5Widgets_LIBRARIES} ${Qt5X11Extras_LIBRARIES})
    set(QT_INCLUDES ${Qt5Core_INCLUDE_DIRS} ${Qt5DBus_INCLUDE_DIRS} ${Qt5Gui_INCLUDE_DIRS} ${Qt5Widgets_INCLUDE_DIRS} ${Qt5X11Extras_INCLUDE_DIRS})
    set(QT_DEFINITIONS ${Qt5Core_DEFINITIONS} ${Qt5DBus_DEFINITIONS} ${Qt5Gui_DEFINITIONS} ${Qt5Widgets_DEFINITIONS} ${Qt5X11Extras_DEFINITIONS})
    # Re-enable deprecated QWeakPointer<QObject*>
    add_definitions(-DQT_DISABLE_DEPRECATED_BEFORE=0)
elseif("${QT_VERSION}" STREQUAL 4 OR "${QT_VERSION}" STREQUAL Qt4)
    message("++ Compiling style for for Qt 4")
    find_package(Qt4 4.8 REQUIRED QtCore QtDBus QtGui)
    include(${QT_USE_FILE})
else()
    message(FATAL_ERROR "QT_VERSION must be either of 4, Qt4, 5, Qt5")
endif()

if(NOT DEFINED LIBRARY_INSTALL_DIR)
    set(LIBRARY_INSTALL_DIR ${CMAKE_INSTALL_PREFIX}/lib)
endif()
if(NOT DEFINED PLUGIN_INSTALL_DIR)
    set(PLUGIN_INSTALL_DIR ${CMAKE_INSTALL_PREFIX}/lib/plugins/styles/)
endif()

message("++ Will install Qt plugin to ${PLUGIN_INSTALL_DIR}")
message("++ Will install support libraries to ${LIBRARY_INSTALL_DIR}")

set(GENERIC_LIB_VERSION 0.0.1)
set(GENERIC_LIB_SOVERSION 0)

set(CMAKE_SKIP_BUILD_RPATH FALSE)
set(CMAKE_BUILD_WITH_INSTALL_RPATH FALSE)
set(CMAKE_INSTALL_RPATH_USE_LINK_PATH FALSE)
set(CMAKE_INSTALL_RPATH ${LIBRARY_INSTALL_DIR})

add_definitions (-DQT3_SUPPORT -DQT3_SUPPORT_WARNINGS)
add_definitions (${QT_DEFINITIONS})
include_directories (${QT_INCLUDES})
include_directories( libs )
add_subdirectory( libs )
add_subdirectory( style )
